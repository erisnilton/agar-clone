var N=Object.defineProperty;var V=(r,e,t)=>e in r?N(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var n=(r,e,t)=>(V(r,typeof e!="symbol"?e+"":e,t),t),F=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var l=(r,e,t)=>(F(r,e,"read from private field"),t?t.call(r):e.get(r)),w=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},O=(r,e,t,i)=>(F(r,e,"write to private field"),i?i.call(r,t):e.set(r,t),t);const H=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}};H();class a{constructor(e=0,t=e){this.x=e,this.y=t}set(e,t=e){return this.x=e,this.y=t,this}get magnitude(){return Math.hypot(this.x,this.y)}get int(){return new a(Math.ceil(this.x),Math.ceil(this.y))}copy(){return new a(this.x,this.y)}copyTo(e){return e.set(this.x,this.y),e}copyFrom(e){return this.set(e.x,e.y),this}add(e){return this.x+=e.x,this.y+=e.y,this}scale(e){return this.x*=e.x,this.y*=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}div(e){return this.x/=e.x,this.y/=e.y,this}normalize(){return this.div(new a(this.magnitude))}static random(e){return new a(Math.random()*e.width+e.x,Math.random()*e.height+e.y)}}class K{constructor(){n(this,"game");n(this,"parent");n(this,"zIndex",0)}find(e){let t=this;for(;t;){if(e(t))return t;t=t.parent}return t}setup(){}update(e){}destroy(){}}class f extends K{constructor(){super(...arguments);n(this,"isVisible",!0);n(this,"position",new a);n(this,"pivot",new a);n(this,"translate",new a);n(this,"scale",new a(1,1));n(this,"angle",0)}get viewPosition(){let t=this;const i=new a;for(;t;)i.add(t.position).add(t.translate).sub(t.pivot),t=t.parent;return i}relativeTo(t){return this.viewPosition.copy().sub(t.viewPosition)}prepareCanvas(t,i){if(!this.isVisible)return;const s=this.position.copy().add(this.translate);t.save(),t.scale(this.scale.x,this.scale.y),t.translate(s.x,s.y),t.rotate(this.angle),t.translate(this.pivot.x,this.pivot.y),i(),t.restore()}}function z(r){return"render"in r&&typeof r.render=="function"}class X extends f{constructor(t){super();n(this,"gridSize");n(this,"canvas",document.createElement("canvas"));n(this,"context",this.canvas.getContext("2d"));n(this,"camera");this.gridSize=t.gridSize,this.camera=t.camera}get normalizedGridSize(){let t=this.camera.zoom*this.gridSize;for(;t<this.gridSize;)t*=2;return t}createPattern(t){const i=this.normalizedGridSize,s=this.context;return this.canvas.width=i,this.canvas.height=i,s.clearRect(0,0,i,i),s.beginPath(),s.moveTo(1,1),s.lineTo(i-1,1),s.lineTo(i-1,i-1),s.strokeStyle="#fff4",s.lineWidth=2,s.stroke(),t.createPattern(this.canvas,"repeat")}render(t){this.prepareCanvas(t,()=>{const i=this.createPattern(t),s=this.normalizedGridSize,o=this.camera.translate.copy().scale(this.camera.scale);t.translate(o.x%s,o.y%s),t.fillStyle=i,t.fillRect(-s,-s,this.game.view.width+s*2,this.game.view.height+s*2)})}}class P extends f{constructor(){super(...arguments);n(this,"children",[]);n(this,"getZIndex",t=>t.zIndex)}sort(){this.children.sort((t,i)=>this.getZIndex(t)-this.getZIndex(i))}add(...t){for(const i of t)i.game=this.game,i.parent=this,this.children.push(i),this.game&&i.setup();return this.sort()}remove(t){t.destroy(),delete t.parent;const i=this.children.indexOf(t);return i>=0&&this.children.splice(i,1),this.sort()}clear(){for(const t of this.children)this.remove(t)}setup(){this.children.forEach(t=>{t.game=this.game,t.parent=this,t.setup()})}update(t){return this.children.forEach(i=>i.update(t)),super.update(t)}render(t){return this.prepareCanvas(t,()=>{this.children.forEach(i=>{z(i)&&i.isVisible&&i.render(t)})})}destroy(){this.children.forEach(t=>t.destroy())}}class Y{constructor(){n(this,"nextFrame");n(this,"queue",new Set);n(this,"frameTime",1e3/60);n(this,"lastTime",0)}get fps(){return 1e3*this.frameTime}set fps(e){this.frameTime=1e3/e}add(e){return this.queue.add(e),this}remove(e){return this.queue.delete(e),this}update(e=performance.now()){if(this.lastTime!=0){const i=(e-this.lastTime)/this.frameTime;this.queue.forEach(s=>s(i))}this.lastTime=e}start(){this.stop();const e=t=>{this.update(t),this.nextFrame=requestAnimationFrame(e)};this.nextFrame=requestAnimationFrame(e)}stop(){cancelAnimationFrame(this.nextFrame)}}var m;class J{constructor(e){n(this,"context");n(this,"stage",new P);n(this,"ticker",new Y);w(this,m,()=>{this.view.width=this.options.resizeTo.innerWidth,this.view.height=this.options.resizeTo.innerHeight});this.options=e,l(this,m).call(this),this.context=this.view.getContext("2d"),this.ticker.add(t=>this.update(t)),this.stage.game=this,this.stage.setup(),this.ticker.start(),this.options.resizeTo.addEventListener("resize",l(this,m))}get view(){return this.options.view}render(){return this.context.resetTransform(),this.context.clearRect(0,0,this.view.width,this.view.height),this.context.fillStyle=this.options.background,this.context.fillRect(0,0,this.view.width,this.view.height),this.stage.render(this.context)}update(e){this.stage.update(e),this.render()}}m=new WeakMap;class Q{constructor(e){n(this,"width");n(this,"height");n(this,"x");n(this,"y");this.width=e.width,this.height=e.height,this.x=e.x,this.y=e.y}}function L(r,e,t){return e>=r&&e<=t}function j(){return"#"+Math.round(Math.random()*16777215).toString(16).padStart(6,"0")}function R(r,e,t){return Math.min(Math.max(r,e),t)}function U(r){class e extends r{constructor(){super(...arguments);n(this,"bounds",new Q({x:0,y:0,width:1e4,height:1e4}))}update(s){super.update(s);for(const o of this.children)!z(o)||(o.position.x=R(o.position.x,this.bounds.x,this.bounds.x+this.bounds.width),o.position.y=R(o.position.y,this.bounds.y,this.bounds.y+this.bounds.height))}render(s){return this.prepareCanvas(s,()=>{s.strokeStyle="red",s.lineWidth=1,s.strokeRect(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height)}),super.render(s)}}return e}class q extends P{constructor(){super(...arguments);n(this,"followingObject",null)}get zoom(){return(this.scale.x+this.scale.y)/2}set zoom(t){t=Math.max(t,0),this.scale.set(t,t)}follow(t){this.followingObject=t}update(t){super.update(t),!(!this.game||!this.followingObject)&&this.translate.set(0,0).sub(this.followingObject.position).add(new a(this.game.view.width/2,this.game.view.height/2).div(this.scale))}}class _ extends U(q){update(e){if(super.update(e),!!this.game){for(const t of this.children)if(z(t)){const i=t.viewPosition.copy().sub(this.viewPosition).add(this.translate);t.isVisible=L(0,i.x,this.game.view.width/this.zoom)&&L(0,i.y,this.game.view.height/this.zoom)}}}}class S extends f{constructor(t){super();n(this,"style");n(this,"text");this.style=t.style,this.text=t.text}render(t){const{text:i,style:s}=this;this.prepareCanvas(t,()=>{var o,h,d,y,p,T,E,C,I,A;t.fillStyle=(o=s.fill)!=null?o:"white",t.textAlign=(h=s.align)!=null?h:"left",t.textBaseline=(d=s.verticalAlign)!=null?d:"top",t.font=`${(y=s.font)==null?void 0:y.weight} ${(p=s.font)==null?void 0:p.size}px ${(T=s.font)==null?void 0:T.family}`,t.fillText(i,0,0),t.lineWidth=(C=(E=s.stroke)==null?void 0:E.width)!=null?C:0,t.strokeStyle=(A=(I=s.stroke)==null?void 0:I.color)!=null?A:"black",t.strokeText(i,0,0)})}}class tt extends S{constructor(t){super({text:"",style:{fill:"white",stroke:{color:"black",width:1},font:{family:"monospace",size:24,weight:"bold"},align:"left",verticalAlign:"bottom"}});n(this,"player");this.player=t.player}get scoreText(){return`Score: ${this.player.score}`}update(t){super.update(t),this.text=this.scoreText}}class k extends f{constructor(t){super();n(this,"radius");this.options=t,this.radius=t.radius}render(t){this.prepareCanvas(t,()=>{t.fillStyle=this.options.color,t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI),t.fill(),t.closePath()})}}const Z=Symbol("isEatable");function B(r){var t;class e extends r{constructor(){super(...arguments);n(this,t,!0);n(this,"score",0);n(this,"body",new k({radius:0,color:""}))}intersects(o){const h=this.position.copy().sub(o.position).magnitude,d=this.body.radius;return h<d}}return t=Z,e}function et(r){return r&&r[Z]}function it(r){class e extends r{constructor(){super(...arguments);n(this,"velocity",new a(0,0));n(this,"acceleration",new a(0,0));n(this,"friction",0)}update(s){this.velocity.add(this.acceleration),this.velocity.scale(new a(1-this.friction)),this.position.add(this.velocity.copy().scale(new a(s))),super.update(s)}}return e}function st(r){var t,i;class e extends r{constructor(){super(...arguments);w(this,t,new a);n(this,"pointerPosition",new a);w(this,i,void 0);n(this,"onPointerMove",h=>{l(this,t).set(h.clientX,h.clientY)})}setup(){var h;super.setup(),(h=this.game)==null||h.view.addEventListener("pointermove",this.onPointerMove),O(this,i,this.find(d=>d instanceof q))}update(h){super.update(h),l(this,i)&&this.pointerPosition.copyFrom(l(this,t)).div(l(this,i).scale).sub(l(this,i).translate)}destroy(){var h;(h=this.game)==null||h.view.removeEventListener("pointermove",this.onPointerMove),super.destroy()}}return t=new WeakMap,i=new WeakMap,e}class b extends B(st(it(P))){constructor(t){var i,s,o;super();n(this,"text");this.options=t,this.body=new k({radius:(i=t.score)!=null?i:0,color:(s=t.skin)!=null?s:"white"}),this.text=new S({text:this.id,style:{fill:"white",stroke:{color:"black",width:this.strokeWidth},font:{family:"Arial",size:this.fontSize,weight:"bold"},align:"center",verticalAlign:"middle"}}),this.score=(o=t.score)!=null?o:0,this.add(this.body,this.text)}get fontSize(){return Math.max(this.body.radius*.4,18)}get strokeWidth(){return this.fontSize*.05}get id(){return this.options.id}get camera(){return this.parent}move(t){this.velocity.copyFrom(t.copy().normalize().scale(new a(4)))}update(t){super.update(t),this.body.radius=this.score/2,this.text.style.font.size=this.fontSize;for(const i of this.camera.children)!et(i)||!i.isVisible||i!=this&&this.intersects(i)&&this.eat(i)}eat(t){this.camera.remove(t),this.score+=t.score}}class W extends b{constructor(){super(...arguments);n(this,"minPointerDistance",10)}setup(){super.setup(),this.ajustZoom()}eat(t){super.eat(t),this.ajustZoom()}ajustZoom(){const i=Math.min(this.game.view.width,this.game.view.height)/this.body.radius/8;this.camera.zoom=Math.min(i,1.5)}update(t){const i=this.pointerPosition.copy().sub(this.position);i.magnitude>=this.minPointerDistance&&this.move(i),super.update(t)}}class x extends B(k){constructor(e){super({radius:4,color:e.color}),this.score=e.score}}class M extends b{update(e){super.update(e);let t=null;for(const i of this.camera.children)if(i instanceof b&&i!==this&&i.score<this.score){const s=i.position.copy().sub(this.position);(!t||s.magnitude<t.magnitude)&&(t=s)}if(!t)for(const i of this.camera.children){if(!(i instanceof x))continue;const s=i.position.copy().sub(this.position);(!t||s.magnitude<t.magnitude)&&(t=s)}t&&(t instanceof x||Math.random()<=.5)&&this.move(t)}}class rt extends S{constructor(t){super({text:"",style:{fill:"white",stroke:{color:"black",width:1},font:{family:"monospace",size:24,weight:"bold"},align:"left",verticalAlign:"bottom"}});n(this,"camera");this.camera=t.camera}update(t){super.update(t);let i=0;for(const s of this.camera.children)s instanceof M&&i++;this.text=`Inimigos: ${i}`}}class nt extends f{constructor(t){super();n(this,"camera");n(this,"size");n(this,"currentPlayer");n(this,"radius",1e3);n(this,"canvas",document.createElement("canvas"));n(this,"draw",this.canvas.getContext("2d"));this.camera=t.camera,this.size=t.size,this.currentPlayer=t.currentPlayer}get factorScale(){const t=new a(this.size/this.camera.bounds.width,this.size/this.camera.bounds.height),i=new a(this.radius*2/this.camera.bounds.width,this.radius*2/this.camera.bounds.height);return t.div(i)}get playerPosition(){return this.calcPosition(this.currentPlayer.position)}calcPosition(t){return t.copy().scale(this.factorScale)}setup(){super.setup(),this.canvas.width=this.size,this.canvas.height=this.size}render(t){this.draw.save(),this.draw.globalAlpha=.8,this.draw.clearRect(0,0,this.size,this.size),this.draw.fillStyle="#1b1b1b",this.draw.fillRect(0,0,this.size,this.size);const i=this.playerPosition,s=this.size/2;this.draw.translate(-i.x+s,-i.y+s),this.draw.globalAlpha=1;for(const o of this.camera.children){if(!(o instanceof b))continue;const h=this.currentPlayer.position.copy().sub(o.position);if(h.magnitude>this.radius)continue;this.draw.globalAlpha=1-h.magnitude/this.radius;const d=o instanceof W,y=Math.max(4,d?6:o.body.radius*(this.factorScale.magnitude/2)),p=this.calcPosition(o.position);this.draw.fillStyle=d?"cyan":"red",this.draw.beginPath(),this.draw.arc(p.x,p.y,y,0,Math.PI*2),this.draw.closePath(),this.draw.fill()}this.draw.restore(),this.prepareCanvas(t,()=>{t.drawImage(this.canvas,0,0,this.size,this.size)})}}const u=new J({resizeTo:window,background:"#000",view:document.getElementById("app")}),c=new _,ot=new X({gridSize:64,camera:c}),g=new W({id:"Eu",score:30,skin:"red"});g.position.copyFrom(a.random(c.bounds));const v=new nt({camera:c,size:240,currentPlayer:g});v.position.set(u.view.width-v.size,u.view.height-v.size);const D=new tt({player:g}),G=new rt({camera:c});G.position.set(20,u.view.height-10-24);D.position.set(20,u.view.height);u.stage.add(ot,c,v,D,G);function $(){for(let r=0;r<500;r++){const e=new x({id:r.toString(),color:j(),score:1});e.position.copyFrom(a.random(c.bounds)),c.add(e)}}$();setInterval($,1e4);for(let r=0;r<50;r++){const e=new M({id:"Inimigo "+(r+1),score:25+Math.random()*20,skin:j()});e.velocity.set((Math.random()-.5)*5,(Math.random()-.5)*5),e.position.copyFrom(a.random(c.bounds)),c.add(e)}c.getZIndex=r=>{var e;return(e=r.score)!=null?e:r.zIndex};c.add(g);c.follow(g);u.ticker.add(()=>{let r=0;for(const e of c.children)e instanceof M&&r++;console.log(r)});
